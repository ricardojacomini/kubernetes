---
# ğŸ³ Container Runtime Setup (all nodes)
- name: "ğŸ› ï¸ Pre-Flight Checks"
  hosts: reservations
  become: true
  gather_facts: true
  vars_files:
    - ../group_vars/main.yml
    - "../group_vars/{{ (ansible_distribution | lower).replace(' ', '_') }}.yml"
  vars:
    container_runtime: docker

  tasks:
    - name: "ğŸ“¦ Include Container Pre-Flight Checks"
      include_role:
        name: container
        tasks_from: main.yml
      tags: [container]

# ğŸš€ Deploy Kubernetes Control Plane
- name: "ğŸš€ Deploy Kubernetes Control Plane"
  hosts: master
  become: true
  gather_facts: true
  vars_files:
    - ../group_vars/main.yml
    - "../group_vars/{{ (ansible_distribution | lower).replace(' ', '_') }}.yml"

  tasks:
    - name: "â˜¸ï¸ Deploy Kubernetes Master Role"
      import_role:
        name: kubernetes
        tasks_from: main.yml
      tags: [kubernetes]

# ğŸ§‘â€ğŸš€ Deploy Kubernetes Worker Nodes
- name: "ğŸ§‘â€ğŸš€ Deploy Kubernetes Workers"
  hosts: workers
  become: true
  gather_facts: true
  vars_files:
    - ../group_vars/main.yml
    - "../group_vars/{{ (ansible_distribution | lower).replace(' ', '_') }}.yml"

  tasks:
    - name: "â˜¸ï¸ Deploy Kubernetes Worker Role"
      import_role:
        name: kubernetes
        tasks_from: main.yml
      tags: [kubernetes]
